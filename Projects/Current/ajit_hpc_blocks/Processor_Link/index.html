<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    
    
    <link rel="../../../../img/favicon.ico">

    
    <title>Processor Link - Embedded Linux | praton</title>
    

    <link rel="stylesheet" href="//use.fontawesome.com/releases/v5.5.0/css/all.css" integrity="sha384-B4dIYHKNBt8Bc12p+WXckhzcICo0wtJAoU8YZTY5qE0Id1GSseTk6S+L3BlXeVIU" crossorigin="anonymous">
    <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/hack-font@3.3.0/build/web/hack.min.css">
    <link href='//fonts.googleapis.com/css?family=PT+Sans:400,400italic,700,700italic&subset=latin-ext,latin' rel='stylesheet' type='text/css'>
    <link href='//fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,700italic,400,300,600,700&subset=latin-ext,latin' rel='stylesheet' type='text/css'>
    <link href="../../../../css/bootstrap-custom.min.css" rel="stylesheet">
    <link href="../../../../css/base.min.css" rel="stylesheet">
    <link href="../../../../css/cinder.min.css" rel="stylesheet">
    <link href="../../../../css/highlight.min.css" rel="stylesheet">

    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
            <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
            <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
        <![endif]-->

    <script src="//ajax.googleapis.com/ajax/libs/webfont/1.6.26/webfont.js"></script>
    <script>
    WebFont.load({
        google: {
            families: ['Open Sans', 'PT Sans']
        }
    });
    </script>

    

     
</head>

<body>

    <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            

            <!-- Main title -->

            <a class="navbar-brand" href="../../../..">Embedded Linux | praton</a>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
                <!-- Main navigation -->
                <ul class="nav navbar-nav">
                
                
                    <li >
                        <a href="../../../..">Home</a>
                    </li>
                
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">OS <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../../../../OS/vmap/">Virtual Mapping</a>
</li>

                        
                            
<li >
    <a href="../../../../OS/BIOS_UEFI/">BIOS & UEFI</a>
</li>

                        
                        </ul>
                    </li>
                
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Processor <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../../../../Processor/basics/">Basics</a>
</li>

                        
                            
<li >
    <a href="../../../../Processor/pipelined/">Pipelined</a>
</li>

                        
                            
<li >
    <a href="../../../../Processor/superscalar/">Superscalar</a>
</li>

                        
                            
<li >
    <a href="../../../../Processor/reservation_station/">Reservation Station</a>
</li>

                        
                        </ul>
                    </li>
                
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Projects <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Current</a>
    <ul class="dropdown-menu">
        
            
<li >
    <a href="../../ajit_hpc/">AJIT HPC System</a>
</li>

        
            
<li >
    <a href="../../iitb_risc_superscalar/">IITB-RISC Superscalar design</a>
</li>

        
    </ul>
  </li>

                        
                            
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Archived</a>
    <ul class="dropdown-menu">
        
            
<li >
    <a href="../../../Archived/pcie_driver/">PCIe C driver</a>
</li>

        
    </ul>
  </li>

                        
                        </ul>
                    </li>
                
                
                
                    <li >
                        <a href="../../../../Tutorials/intro/">Tutorials</a>
                    </li>
                
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Guides <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../../../../Guides/How_to_Embedded_Resume/main/">How to make an Embedded Resume</a>
</li>

                        
                            
<li >
    <a href="../../../../Guides/How_to_use_mutt/main/">How to use mutt</a>
</li>

                        
                        </ul>
                    </li>
                
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Ricing <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../../../../Ricing/gtk/">GTK changes</a>
</li>

                        
                            
<li >
    <a href="../../../../Ricing/boot_screen/">Boot screen changes</a>
</li>

                        
                            
<li >
    <a href="../../../../Ricing/grub/">Tinkering with GRUB</a>
</li>

                        
                        </ul>
                    </li>
                
                
                
                    <li >
                        <a href="../../../../About/about/">About</a>
                    </li>
                
                
                </ul>

            <ul class="nav navbar-nav navbar-right">
                    <li>
                        <a href="#" data-toggle="modal" data-target="#mkdocs_search_modal">
                            <i class="fas fa-search"></i> Search
                        </a>
                    </li>
            </ul>
        </div>
    </div>
</div>

    <div class="container">
        
        
        <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
        <li class="first-level active"><a href="#processor-link">Processor Link</a></li>
            <li class="second-level"><a href="#need-for-the-processor-link">Need for the Processor Link</a></li>
                
            <li class="second-level"><a href="#driver-api">Driver API</a></li>
                
            <li class="second-level"><a href="#approach-to-write-the-driver">Approach to write the driver</a></li>
                
                <li class="third-level"><a href="#fpga_open">fpga_open(...)</a></li>
                <li class="third-level"><a href="#fpga_close">fpga_close(...)</a></li>
                <li class="third-level"><a href="#send_u64_to_processor">send_u64_to_processor(...)</a></li>
                <li class="third-level"><a href="#recv_u64_from_processor">recv_u64_from_processor(...)</a></li>
            <li class="second-level"><a href="#explaining-polling-method">Explaining polling method</a></li>
                
            <li class="second-level"><a href="#need-for-interrupt-based-support-in-future">Need for interrupt based support in future</a></li>
                
            <li class="second-level"><a href="#testing-of-the-driver">Testing of the driver</a></li>
                
    </ul>
</div></div>
        <div class="col-md-9" role="main">

<h1 id="processor-link">Processor Link</h1>
<h2 id="need-for-the-processor-link">Need for the Processor Link</h2>
<p>For the previous iteration of already developed software programs for AJIT to work with the new FPGA model we need to keep the same names of the 
API calls and need to have a Driver API interface which provides the same functions but with non-trivial and different inherent implementations.</p>
<h2 id="driver-api">Driver API</h2>
<p>The four black boxed functions that the API provides are:</p>
<pre><code class="c">int fpga_open(...){
...
}

int fpga_close(...){
...
}

int recv_u64_from_processor(uint64_t* r_word){
...
}

int send_u64_to_processor(uint64_t* s_word){
...
}
</code></pre>

<h2 id="approach-to-write-the-driver">Approach to write the driver</h2>
<p>Driver infrastructure can be broken down in four simple parts:</p>
<h3 id="fpga_open"><code>fpga_open(...)</code></h3>
<p>As would be evident by the name this function opens a fpga device and returns the status of the opened device and prints error message if it fails to 
open the device. This function takes a string defined by a C preprocessor which points to the resource file of the fpga device. Every resource file 
created represents a <strong>BAR</strong> created during the hardware flow. To open the fpga device it makes a <code>open(...)</code> system call with Read, Write and I/O 
SYNC flags to have the access permissions.</p>
<h3 id="fpga_close"><code>fpga_close(...)</code></h3>
<p>As would be evident by the name this function closes an already open fpga device and returns the status of the device and prints error message if it fails to close the device. This function unmaps the memory mapped base address of the FIFO controller and then makes <code>close(...)</code> system call to close the 
fpga device.</p>
<h3 id="send_u64_to_processor"><code>send_u64_to_processor(...)</code></h3>
<p>This function is used to send a 64-bit word to the processor core. The approach here is to memory map the base address of the FIFO controllers and 
providing the required offset to the data registers. For memory mapping we use <code>mmap</code> with PROT_READ and PROT_WRITE flags set so that we have the 
read-write access. We ineffect get a pointer to the memory location of the data registers which we can dereference to write our splitted data one by one. 
This function after writing the data registers, polls the success bit in the control register and as soon as it is set the function returns. </p>
<h3 id="recv_u64_from_processor"><code>recv_u64_from_processor(...)</code></h3>
<p>This function is used to receive a 64-bit word from the processor core. The approach again here is to memory map the base address of the FIFO controllers 
and providing the required offset to the data registers. For memory mapping we use <code>mmap</code> with PROT_READ and PROT_WRITE flags set so that we have the 
read-write access.This function before reading the data registers, polls the valid bit in the control register and as soon as it is set the function reads the data. We ineffect get a pointer to the memory location of the data registers which we can dereference to read our splitted data one by one.</p>
<h2 id="explaining-polling-method">Explaining polling method</h2>
<p>The way in we perform a transfer of a 64-bit number is that we split it into two 32-bit numbers and write it out to 32 -bit memory mapped registers inside the FIFO controllers from where the data is sent to the Debug FIFOs.For simplicity the driver currently continuosly polls the control register of the FIFO controllers and checks for the status bit to set and finishes the API call as soon it sets and returns the received data/status dependent upon the API 
call made. </p>
<h2 id="need-for-interrupt-based-support-in-future">Need for interrupt based support in future</h2>
<p>To avoid the redundant polling approach we are going to introduce an interrupt based driver API which would would contain ISR routines responding to the 
PCIe-AXI interface generated interrupts. For this functionality we most probably would need to have a <strong>Kernel Space Module</strong> which would have direct 
access to Kernel ISR routines and would allow us to respond to specifically VC709 generated interrupts on the PCIe bus.  </p>
<h2 id="testing-of-the-driver">Testing of the driver</h2>
<p>Preliminary tests were conducted using <strong>pcimem</strong> utility with successfull results but extensive tests on the driver are still pending and would be 
completed in near future.</p></div>
        
        
    </div>

    <footer class="col-md-12 text-center">
        
        <hr>
        <p>
        <small>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a>.</p></small>

        
        
    </footer>
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
    <script src="../../../../js/bootstrap-3.0.3.min.js"></script>
    <script src="../../../../js/highlight.pack.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script>var base_url = "../../../.."</script>
    
    <script src="../../../../js/base.js"></script>
    <script src="../../../../search/main.js"></script>

    <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
                <p>
                    From here you can search these documents. Enter
                    your search terms below.
                </p>
                <form>
                    <div class="form-group">
                        <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>
    </body>

</html>
